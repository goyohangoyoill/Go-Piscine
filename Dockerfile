###############################################################################
#                                                       Image Info on builder
###############################################################################
FROM		golang:1.17-alpine as builder

###############################################################################
#                                                       Task Info on builder
###############################################################################
WORKDIR		/build
COPY		../srcs srcs/

WORKDIR		/build/srcs
RUN			go mod tidy
RUN			go build -o piscine-golang-interact

###############################################################################
#                                                       Image Info on publish
###############################################################################
FROM		alpine

###############################################################################
#                                                       Copy Files on publish
###############################################################################
WORKDIR		/run
RUN			mkdir secret
COPY		--from=builder /build/srcs/piscine-golang-interact ./piscine-golang-interact
COPY		--from=builder /build/srcs/secret/config.json ./secret/config.json

###############################################################################
#                                                       Open Ports on publish
###############################################################################
EXPOSE		80		443

###############################################################################
#                                                       Starting on publish
###############################################################################
ENTRYPOINT	["./piscine-golang-interact"]
